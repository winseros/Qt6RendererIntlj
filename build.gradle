plugins {
    id "org.jetbrains.intellij" version "1.16.1"
    id "java"
}

group = "n.v.k"
version = hasProperty("buildVersion") ? buildVersion : "1.0-SNAPSHOT"

repositories {
    mavenCentral()
}

dependencies {
}

// See https://github.com/JetBrains/gradle-intellij-plugin/
buildSearchableOptions.enabled = false
intellij {
    version = "2021.3.1"
    type = "CL"
    plugins = ["com.intellij.cidr.base", "com.intellij.clion"]
    targetCompatibility = 11
}

patchPluginXml {
    changeNotes = """
      * 1.1.1
      - Minor render bug fixes

      * 1.1.0
      - GDB support
      - LLDB code rewritten
      
      * 1.0.0
      Initial version"""
    sinceBuild = "213.6461"
    untilBuild = ""
}

task copyPrettyPrinters(type: Copy) {
    dependsOn "prepareSandbox"
    from project.layout.projectDirectory.dir("qt6renderer/python")
    include "**/*.py"
    into project.layout.buildDirectory.dir("idea-sandbox/plugins/Qt6Renderer/python").get()
}

buildPlugin {
    dependsOn "copyPrettyPrinters"
}

runIde {
    dependsOn "copyPrettyPrinters"
}

test {
    useJUnitPlatform()
}
